# Requirements Document

## Introduction

「居酒屋レビュー検索」は、ユーザーが自然言語で希望条件を入力することで、その条件に合った居酒屋を検索できるウェブサービスです。このサービスは、Google Places APIから定期的に取得した口コミデータを活用し、ユーザーの質問に対して最適な居酒屋を推薦します。例えば「上司といける海鮮がうまい店」や「彼女といける雰囲気の良い店」といった自然な問いかけに対して、関連する口コミ情報を基に最適な店舗を提案します。

## Requirements

### 1. 自然言語検索機能

**User Story:** 利用者として、自然言語で希望条件を入力し、それに合った居酒屋を検索したい。そうすることで、自分の具体的なニーズに合った店舗を簡単に見つけることができる。

#### Acceptance Criteria

1. WHEN ユーザーが自然言語（例：「上司といける海鮮がうまい店」）で検索クエリを入力 THEN システムはその意図を理解し、関連する居酒屋を検索結果として表示する
2. WHEN ユーザーが複数の条件（例：「安くて、個室があり、駅から近い居酒屋」）を含むクエリを入力 THEN システムは全ての条件を考慮した検索結果を表示する
3. WHEN 検索結果が表示される THEN 各居酒屋がユーザーのクエリにどのように関連しているかの説明が表示される
4. WHEN システムが検索を実行する THEN まず所在地、個室の有無、営業時間などの構造化データで絞り込みを行い、その後口コミの類似度で順位付けを行う
5. WHEN 検索結果が多数ある場合 THEN 最大20件までの結果を表示し、さらに絞り込むための追加条件の例を提示する
6. IF 検索クエリに合致する居酒屋が見つからない THEN システムは「全ての条件に合致する店舗は見つかりませんでした」というメッセージを表示し、どの条件を緩めれば結果が得られるかを提案する

### 2. データ収集と管理

**User Story:** システム管理者として、Google Places APIを使用して居酒屋の情報と口コミを定期的に収集し、最新の情報をユーザーに提供したい。

#### Acceptance Criteria

1. WHEN システムがスケジュールされたタイミングで実行される THEN Google Places APIを使用して登録された居酒屋の情報（口コミ、価格帯、営業時間など）を取得する
2. WHEN 新しいデータが取得される THEN システムはデータベースの情報を更新し、検索インデックスを再構築する
3. WHEN 口コミデータが取得される THEN システムはLLMを使用して関連キーワードを抽出し、効率的な検索のためにキーワードベースのインデックスに保存する
4. WHEN 居酒屋の基本情報（所在地、個室の有無、営業時間など）が取得される THEN システムはこれらの構造化データを検索可能な形式でデータベースに保存する
5. IF APIからのデータ取得に失敗した場合 THEN システムはエラーをログに記録し、管理者に通知する

### 3. ユーザーインターフェース

**User Story:** 利用者として、シンプルで使いやすいインターフェースを通じて、居酒屋を検索し結果を閲覧したい。

#### Acceptance Criteria

1. WHEN ユーザーがサイトにアクセスする THEN 検索ボックスが目立つ位置に表示される
2. WHEN ユーザーが検索を実行する THEN システムは検索中であることを示すローディングインジケータを表示する
3. WHEN 検索結果が表示される THEN 各居酒屋の基本情報（名前、住所、評価、価格帯）が一覧で表示される
4. WHEN ユーザーが検索結果の居酒屋をクリックする THEN その居酒屋の詳細情報（口コミ、写真、営業時間など）が表示される
5. WHEN ユーザーがモバイルデバイスからアクセスする THEN レスポンシブデザインにより適切に表示される

### 4. RAGベースの回答生成

**User Story:** 利用者として、自分の質問に対して関連する口コミ情報を基にした具体的な回答を得たい。

#### Acceptance Criteria

1. WHEN ユーザーが質問を入力する THEN システムはLLMを使用して検索クエリからキーワードを抽出し、それらのキーワードを使用して関連する口コミデータを検索する
2. WHEN システムが関連する口コミデータを見つける THEN それらを使用して質問に対する具体的な回答を生成する
3. WHEN 回答が生成される THEN 回答の根拠となった口コミ情報の要約も併せて表示する
4. WHEN 検索結果が生成される THEN 構造化データ（営業時間、個室の有無など）による絞り込みとキーワードマッチングを組み合わせた結果を提示する
5. IF ユーザーの要望全てに合致する店舗がない場合 THEN システムはその旨を明示し、どの条件を緩めれば結果が得られるかを具体的に提案する
6. IF 質問に関連する口コミデータが不足している THEN システムはその旨を明示し、利用可能な情報のみに基づいた回答を提供する

### 5. コスト最適化

**User Story:** システム管理者として、サービスの機能を維持しながらも、実装と運用のコストを最小限に抑えたい。

#### Acceptance Criteria

1. WHEN システムがデプロイされる THEN サーバーレスアーキテクチャを活用してインフラストラクチャコストを最小化する
2. WHEN キーワードベースの検索が必要とされる THEN 可能な限りコスト効率の高いデータベースソリューションを選択する
3. WHEN APIが呼び出される THEN レート制限を考慮し、必要最小限の呼び出しに最適化する
4. IF システムの負荷が増加した場合 THEN 自動的にスケールするが、コスト効率を維持するための制限を設ける